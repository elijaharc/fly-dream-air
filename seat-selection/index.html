<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FlyDreamAir | Seat Selection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/seat-selection.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100">
    <header class="bg-white py-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center px-4">
            <a href="/" class="flex items-center gap-2">
                <img src="/img/logo.png" alt="FlyDreamAir logo" class="h-8 w-8">
                <span class="font-bold text-lg" style="color: #262A3F;">FlyDreamAir</span>
            </a>
            <nav class="space-x-4">
                <a href="/book-flight" class="text-gray-600 hover:text-blue-500 transition duration-300">Book</a>
                <a href="/user-flight-info" class="text-gray-600 hover:text-blue-500 transition duration-300">Travel Info</a>
                <a href="/about" class="text-gray-600 hover:text-blue-500 transition duration-300">About</a>
            </nav>
        </div>
    </header>
    <!-- Step Progress Bar: Move here, below nav bar -->
    <div
        class="bg-[#6AABDD] rounded-xl w-[1025px] mx-auto mt-6 shadow-md px-6 py-3 flex justify-between items-center text-white text-sm font-semibold">
        <!-- Step 1 -->
        <div class="flex flex-col items-center w-1/4 relative">
            <div
                class="absolute -top-8 bg-white text-[#263FAD] w-9 h-9 rounded-full flex items-center justify-center font-bold border border-gray-300">
                1
            </div>
            <span class="mt-3 text-darkblue font-bold">
                Choose Flight
            </span>
        </div>
        <!-- Step 2 -->
        <div class="flex flex-col items-center w-1/4 relative">
            <div
                class="absolute -top-8 bg-white text-[#6A7BD9] w-9 h-9 rounded-full flex items-center justify-center font-bold border border-gray-300">
                2
            </div>
            <span class="mt-3 text-white">
                Add-Ons
            </span>
        </div>
        <!-- Step 3 -->
        <div class="flex flex-col items-center w-1/4 relative">
            <div
                class="absolute -top-8 bg-white text-[#6A7BD9] w-9 h-9 rounded-full flex items-center justify-center font-bold border border-gray-300">
                3
            </div>
            <span class="mt-3 text-black">
                Seat Selection
            </span>
        </div>
        <!-- Step 4 -->
        <div class="flex flex-col items-center w-1/4 relative">
            <div
                class="absolute -top-8 bg-white text-[#6A7BD9] w-8 h-8 rounded-full flex items-center justify-center font-bold border border-gray-300">
                4
            </div>
            <span class="mt-3 text-white">
                Payment
            </span>
        </div>
    </div>
    <main class="container mx-auto px-4 py-10 flex gap-8">
        <!-- Left Side (75%) -->
        <div class="w-[58%] flex flex-col gap-8">
            <!-- Ticket Information  -->
            <div class="ticket-box flex justify-between items-center relative bg-gray-300 rounded-xl px-6 py-4">
                <div class="text-left">
                    <div id="from-location" class="text-lg font-semibold"></div>
                    <div id="departure-date" class="text-sm text-gray-600"></div>
                </div>
                <div class="text-center flex flex-col items-center justify-center w-1/3">
                    <div class="flex items-center justify-center w-full">
                        <span class="text-2xl mx-2 select-none">âœˆ</span>
                    </div>
                </div>
                <div class="text-right">
                    <div id="to-location" class="text-lg font-semibold"></div>
                    <div id="return-date" class="text-sm text-gray-600"></div>
                </div>
            </div>
            <!-- Ticket Info (bottom left div) -->
            <div class="bg-gray-300 rounded-xl shadow-md px-6 py-6 flex-1 relative overflow-visible">
                <h2 class="text-xl font-semibold mb-4 text-center absolute left-1/2 -top-6 -translate-x-1/2 bg-gray-300 px-4 py-1 rounded-t-xl z-10" style="top: -1.5rem;">Add-On Info</h2>
                <div id="addon-info" class="text-gray-700 space-y-2"></div>
                <!-- New bottom div for Seating info -->
                <div class="relative mt-8 bg-white rounded-xl shadow px-4 pt-8 pb-6 overflow-visible" style="min-height: 120px;">
                  <h3 class="absolute left-1/2 -top-6 -translate-x-1/2 bg-white px-4 py-1 rounded-t-xl text-lg font-bold z-10 border border-gray-300" style="top: -1.5rem;">Seating info</h3>
                  <div class="mb-2">
                    <span class="font-semibold">Total Tickets:</span> <span id="seating-total-tickets">-</span>
                  </div>
                  <div class="mb-4">
                    <span class="font-semibold">Selected Seats:</span>
                    <span id="seating-selected-seats" class="ml-2 text-blue-700"></span>
                  </div>
                </div>
                <div class="w-full flex flex-col items-center mt-6">
                  <button id="seating-save-proceed" class="px-14 py-4 text-lg bg-[#6AABDD] text-white rounded-full transition-transform duration-150 hover:scale-110 hover:bg-[#5a9ac7] focus:outline-none focus:ring-2 focus:ring-indigo-500" style="min-width: 220px;">Save and proceed</button>
                  <div id="seating-error-msg" class="text-red-600 text-sm mt-2 text-center min-h-[22px] w-full"></div>
                </div>
            </div>
        </div>
        <!-- Right Side (seat map, thinner and pressed right) -->
        <div class="w-[32%] flex flex-col h-full">
            <div class="bg-gray-300 rounded-xl shadow-md px-6 py-6 h-full flex flex-col items-center justify-center min-h-[600px] relative overflow-visible" style="min-height: 600px;">
                <!-- Right div (seat map) -->
                <h2 id="seat-map-header" class="text-xl font-semibold mb-4 text-center absolute left-1/2 -top-6 -translate-x-1/2 bg-gray-300 px-4 py-1 rounded-t-xl z-10" style="top: -1.5rem;">Seat Map</h2>
                <div id="seat-map" class="flex flex-col items-center gap-4 mt-6 mb-6" style="height: 420px; justify-content: center;"></div>
            </div>
        </div>
    </main>
    <script src="js/seat-selection.js"></script>
    <script>
    // Populate ticket-box with booking info (same as add-on page, minus ticket count)
    document.addEventListener('DOMContentLoaded', function() {
        const bookingInfo = JSON.parse(localStorage.getItem('bookingInfo')) || {};
        const { departure, arrival, departureDate, arrivalDate, ticketCount } = bookingInfo;
        if (departure && arrival && departureDate && arrivalDate) {
            document.getElementById('from-location').textContent = departure;
            document.getElementById('departure-date').textContent = departureDate;
            document.getElementById('to-location').textContent = arrival;
            document.getElementById('return-date').textContent = arrivalDate;
        }
        // Update seat map header with ticket count if available
        if (typeof ticketCount !== 'undefined' && !isNaN(ticketCount)) {
            const seatMapHeader = document.getElementById('seat-map-header');
            if (seatMapHeader) {
                seatMapHeader.textContent = `Please select ${ticketCount} seat${ticketCount > 1 ? 's' : ''}`;
            }
        }
        // Render seat map
        const seatMapDiv = document.getElementById('seat-map');
        if (seatMapDiv) {
            seatMapDiv.style.height = '420px'; // Ensure seat map is tall
            seatMapDiv.style.justifyContent = 'center';
            const rows = ['A','B','C','D','E','F','G','H'];
            const cols = [1,2,3,4,5,6];
            // Business class wrapper for rows A and B
            const businessClassDiv = document.createElement('div');
            businessClassDiv.className = 'business-class-bg flex flex-col items-center mb-2';
            // Add rows A and B to business class div
            ['A','B'].forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex items-center gap-3 mb-3';
                cols.forEach((col, colIdx) => {
                    if (colIdx === 3) {
                        const aisle = document.createElement('div');
                        aisle.style.width = '28px';
                        rowDiv.appendChild(aisle);
                    }
                    const seatBtn = document.createElement('button');
                    seatBtn.className = 'seat-btn font-semibold text-sm focus:outline-none';
                    seatBtn.textContent = row + col;
                    seatBtn.setAttribute('data-seat', row + col);
                    seatBtn.addEventListener('click', function() {
                        seatBtn.classList.toggle('selected');
                    });
                    rowDiv.appendChild(seatBtn);
                });
                businessClassDiv.appendChild(rowDiv);
            });
            // Add business class label
            const businessLabel = document.createElement('div');
            businessLabel.textContent = 'Business class seats';
            businessLabel.className = 'text-green-900 font-semibold text-sm mt-1 mb-1';
            businessLabel.style.textAlign = 'center';
            businessClassDiv.appendChild(businessLabel);
            seatMapDiv.appendChild(businessClassDiv);
            // Add the rest of the rows
            rows.slice(2).forEach(row => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'flex items-center gap-3 mb-3';
                cols.forEach((col, colIdx) => {
                    if (colIdx === 3) {
                        const aisle = document.createElement('div');
                        aisle.style.width = '28px';
                        rowDiv.appendChild(aisle);
                    }
                    const seatBtn = document.createElement('button');
                    seatBtn.className = 'seat-btn font-semibold text-sm focus:outline-none';
                    seatBtn.textContent = row + col;
                    seatBtn.setAttribute('data-seat', row + col);
                    seatBtn.addEventListener('click', function() {
                        seatBtn.classList.toggle('selected');
                    });
                    rowDiv.appendChild(seatBtn);
                });
                seatMapDiv.appendChild(rowDiv);
            });
        }
    });
    </script>
</body>
</html>
